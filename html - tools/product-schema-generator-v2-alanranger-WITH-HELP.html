
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Product Schema Generator with Reviews (Alan Ranger)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 2rem;
    }
    h1 {
      font-size: 1.8rem;
      margin-bottom: 0.5rem;
    }
    .instructions {
      background-color: #f4f4f4;
      padding: 1rem;
      border-radius: 6px;
      margin-bottom: 1.5rem;
      line-height: 1.6;
    }
    textarea {
      width: 100%;
      height: 300px;
      margin-top: 1rem;
      font-family: monospace;
    }
  </style>
</head>
<body>

<h1>Product Schema Generator with Reviews (Alan Ranger)</h1>


<div class="instructions">
  <strong>Instructions:</strong><br>
  1. Click <b>Choose File</b> and upload your product CSV or XLSX file (e.g. <code>products_with_review_data_final.xlsx</code>).<br>
  2. Ensure your file includes the columns: <code>name</code>, <code>description</code>, <code>image</code>, <code>url</code>, <code>reviews</code>.<br>
  3. Reviews below 4â˜… will be excluded automatically.<br>
  4. If a product has no reviews or only low-rated reviews, the schema will exclude the <code>aggregateRating</code> block.<br>
  5. Click <b>Generate Schema</b> to produce the JSON-LD script per product.<br>
  6. Copy and paste the output into your Squarespace product page via <b>Page Settings â†’ Advanced â†’ Header Code Injection</b> or inside a <b>Code Block</b> on the product page.<br><br>

  âœ… Works entirely offline in your browser.<br>
  âœ… Based on Alan Rangerâ€™s structured schema format for Google Rich Results.<br><br>

  <strong>ðŸ“„ Workflow Example:</strong><br>
  <pre style="background:#eee; padding:0.75rem; border-radius:6px;">
  Step 1: products_Jul-21_01-43-36PM cleaned.xlsx
       â†“
  Step 2: products_with_review_data_final.xlsx
       â†“
  Step 3: alanranger_product_schema_FINAL_WITH_REVIEW_RATINGS.xlsx
       â†“
  Step 4: Paste per product into Squarespace (Header Code Injection or Code Block)
  </pre>
</div>


<input type="file" id="csvFile" accept=".csv">
<button onclick="generateSchema()">Generate Schema</button>

<h3>Generated JSON-LD Schema:</h3>
<textarea id="output" readonly></textarea>

<script>
  function generateSchema() {
    const fileInput = document.getElementById('csvFile');
    const output = document.getElementById('output');

    if (!fileInput.files.length) {
      alert("Please upload a CSV file first.");
      return;
    }

    const reader = new FileReader();
    reader.onload = function (event) {
      const text = event.target.result;
      const lines = text.trim().split('\n');
      const headers = lines[0].split(',');
      const data = lines.slice(1).map(row => {
        const cols = row.split(',');
        let obj = {};
        headers.forEach((h, i) => {
          obj[h.trim()] = cols[i]?.trim();
        });
        return obj;
      });

      const outputSchema = data.map(product => {
        const reviews = JSON.parse(product.reviews || '[]').filter(r => Number(r.rating) >= 4);
        const reviewCount = reviews.length;
        const averageRating = reviewCount > 0 ? (
          reviews.reduce((sum, r) => sum + Number(r.rating), 0) / reviewCount
        ).toFixed(1) : null;

        let schema = {
          "@context": "https://schema.org/",
          "@type": "Product",
          "name": product.name,
          "image": product.image,
          "description": product.description,
          "url": product.url
        };

        if (reviewCount > 0) {
          schema.aggregateRating = {
            "@type": "AggregateRating",
            "ratingValue": averageRating,
            "reviewCount": reviewCount
          };

          schema.review = reviews.map(r => ({
            "@type": "Review",
            "author": r.author,
            "reviewRating": {
              "@type": "Rating",
              "ratingValue": r.rating,
              "bestRating": "5",
              "worstRating": "1"
            },
            "reviewBody": r.body
          }));
        }

        return `<script type="application/ld+json">\n${JSON.stringify(schema, null, 2)}\n</script>`;
      }).join('\n\n');

      output.value = outputSchema;
    };

    reader.readAsText(fileInput.files[0]);
  }
</script>

</body>
</html>
